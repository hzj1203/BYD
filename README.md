# 比亚迪自动控车APP

基于蓝牙连接状态自动控制比亚迪车辆解锁/上锁的Android应用程序。

## 🚗 功能特性

- ✅ **自动解锁**: 手机连上车机蓝牙时自动解锁车辆
- ✅ **自动上锁**: 手机断开蓝牙连接时自动上锁车辆
- ✅ **信号强度控制**: 根据蓝牙信号强度(dBm)智能判断是否在车内
- ✅ **手动控制**: 支持手动解锁/上锁车辆
- ✅ **自定义设置**: 可调整信号阈值、延迟时间等参数
- ✅ **多设备支持**: 支持选择多个目标蓝牙设备
- ✅ **后台服务**: 应用在后台持续监控蓝牙状态
- ✅ **安全加密**: 使用Android密钥库加密存储敏感信息

## 📋 系统要求

- **Android版本**: 8.0 (API 26) 或更高
- **蓝牙**: 支持BLE (Bluetooth Low Energy)
- **权限**: 蓝牙、位置权限
- **比亚迪车辆**: 支持蓝牙连接的车型

## 🔧 安装步骤

### 1. 下载并安装Android Studio
```
https://developer.android.com/studio
```

### 2. 配置开发环境
- 安装Android SDK (API 34)
- 安装Build Tools
- 配置环境变量

### 3. 构建应用
```bash
# 克隆项目
git clone <repository-url>
cd android_app

# 构建APK
./gradlew assembleDebug
```

### 4. 安装到手机
```bash
# 连接手机并启用USB调试
adb devices

# 安装APK
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

## ⚙️ 配置使用

### 首次使用
1. **安装应用**后打开
2. **授予权限**: 允许蓝牙和位置权限
3. **启用蓝牙**: 确保手机蓝牙已开启

### 车辆配置
1. 点击**设置**按钮
2. **输入VIN码**: 在"车辆信息"部分输入你的车辆VIN码
3. **获取访问令牌**: 需要从比亚迪官方APP或开发者平台获取API访问令牌

### 蓝牙设备设置
1. 在设置中点击**"扫描配对设备"**
2. 选择你的比亚迪车机蓝牙设备
3. 可以选择多个设备（主驾驶、副驾驶等）

### 信号强度设置
- **解锁阈值**: 当信号强度超过此值时自动解锁 (默认-60dBm)
- **上锁阈值**: 当信号强度低于此值时自动上锁 (默认-80dBm)

### 延迟设置
- **解锁延迟**: 连接后等待多长时间再解锁 (默认2秒)
- **上锁延迟**: 断开后等待多长时间再上锁 (默认5秒)

## 🔑 API配置

### 获取比亚迪API访问令牌

由于比亚迪官方API需要授权，以下是几种获取方式：

#### 方法1: 比亚迪开发者平台
1. 注册比亚迪开发者账号
2. 创建应用获取API密钥
3. 使用OAuth2流程获取访问令牌

#### 方法2: 逆向工程（不推荐）
⚠️ **警告**: 此方法可能违反服务条款
- 从比亚迪APP中提取API调用
- 分析网络请求获取令牌

#### 方法3: 第三方集成
- 使用现有的比亚迪集成服务
- 联系比亚迪售后获取API权限

### API端点配置
在 `RetrofitClient.kt` 中修改：
```kotlin
private const val BASE_URL = "https://你的API地址/"
```

## 🔒 安全注意事项

- ✅ **加密存储**: 所有敏感信息使用Android密钥库加密
- ✅ **权限最小化**: 只请求必要的权限
- ✅ **网络安全**: 使用HTTPS进行API通信
- ✅ **令牌管理**: 自动刷新过期的访问令牌
- ⚠️ **物理安全**: 确保手机不被盗用
- ⚠️ **信号欺骗**: 蓝牙信号可能被干扰或伪造

## 🛠️ 故障排除

### 常见问题

#### 1. 蓝牙连接失败
```
解决方案:
- 确保车辆蓝牙已开启
- 检查设备是否正确配对
- 尝试重新配对设备
```

#### 2. 自动控制不工作
```
检查项:
- 服务是否正在运行
- 信号阈值设置是否合理
- 车辆API令牌是否有效
- 网络连接是否正常
```

#### 3. 信号强度不准确
```
原因:
- 蓝牙信号受环境影响
- 设备硬件差异
- 建议: 实际测试后调整阈值
```

#### 4. API调用失败
```
检查:
- 访问令牌是否过期
- 车辆VIN码是否正确
- 网络连接是否稳定
- API端点是否可访问
```

### 日志查看
```bash
# 查看应用日志
adb logcat | grep BydAutoLock

# 查看服务状态
adb shell dumpsys activity services BydAutoLock
```

## 📱 用户界面

### 主界面
- **状态显示**: 实时显示蓝牙连接状态、信号强度、最后操作
- **手动控制**: 解锁/上锁按钮
- **服务控制**: 启动/停止后台监听服务

### 设置界面
- **车辆信息**: VIN码输入
- **自动控制**: 开关设置
- **信号阈值**: 滑块调整
- **设备选择**: 多选蓝牙设备
- **延迟配置**: 时间设置

## 🔄 更新日志

### v1.0.0 (当前版本)
- ✅ 基础蓝牙监听功能
- ✅ 车辆控制API集成
- ✅ 信号强度判断
- ✅ 用户界面优化
- ✅ 安全加密存储

### 计划功能
- 🔄 支持更多比亚迪车型
- 🔄 地理围栏功能
- 🔄 语音控制集成
- 🔄 车辆状态实时显示

## 📄 开源协议

本项目仅供学习和研究使用，请遵守相关法律法规。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 📞 技术支持

如果遇到问题，请：
1. 查看故障排除部分
2. 提交GitHub Issue
3. 提供详细的错误信息和日志

---

**⚠️ 重要提醒**: 请在使用前测试所有功能，确保车辆安全。作者不对使用本应用造成的任何损失负责。